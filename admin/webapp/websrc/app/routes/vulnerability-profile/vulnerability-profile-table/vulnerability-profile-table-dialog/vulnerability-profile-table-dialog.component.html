<div class="d-flex flex-row align-items-center justify-content-between">
  <h1 class="h4">
    {{
      edit
        ? ('cveProfile.EDIT_CVE_PROFILE' | translate)
        : ('cveProfile.ADD_CVE_PROFILE' | translate)
    }}
  </h1>
  <button (click)="onNoClick()" aria-label="Close dialog" mat-icon-button>
    <i class="eos-icons">close</i>
  </button>
</div>
<form [formGroup]="form">
  <section class="ml-2">
    <div class="d-flex flex-row">
      <label class="mr-3">{{ 'cveProfile.PROFILE_FILTER_TYPE' | translate }}</label>
      <mat-radio-group>
        <mat-radio-button value="0" class="mr-2" (click)="changeView(0)" [checked]="true">
          {{ 'cveProfile.gridHeader.VULNERABILITY' | translate }}
        </mat-radio-button>
        <mat-radio-button value="1" class="mr-2" (click)="changeView(1)">
          {{ 'cveProfile.REPORTED_TIME' | translate }}
        </mat-radio-button>
        <mat-radio-button value="2" class="mr-2" (click)="changeView(2)">
          {{ 'cveProfile.REPORTED_TIME' | translate }} ({{ 'cveProfile.WITH_FIX' | translate }})
        </mat-radio-button>
      </mat-radio-group>
    </div>
    <ng-container [ngSwitch]="view">
      <div class="w-100 align-items-center">
        <ng-container *ngSwitchCase="View.NAME" class="d-flex flex-row">
          <label for="name" class="mr-2">{{ 'cveProfile.NAME' | translate }}</label>
          <mat-form-field appearance="standard" style="width: 50%">
            <input
              formControlName="name"
              id="name"
              matInput
              [attr.maxlength]="'general.FILTER_MAX_LEN' | translate" />
            <mat-hint>{{'cveProfile.hint.NAME' | translate}}</mat-hint>
            <mat-error *ngIf="form.controls.name.hasError('required')">
              {{ 'setting.webhook.NAME_EMPTY' | translate }}
            </mat-error>
          </mat-form-field>
        </ng-container>
        <ng-container *ngSwitchCase="View.WITH_FIX" class="d-flex flex-row">
          <label for="withFix" class="mr-2">{{ 'cveProfile.REPORTED_WITHIN' | translate }}</label>
          <mat-form-field appearance="standard" style="width: 40px;">
            <input
              formControlName="withFix"
              id="withFix"
              matInput
              (keydown)="onDaysInput($event)"
              (paste)="onDaysInput($event)"
              [attr.maxlength]="5" />
            <mat-error *ngIf="form.controls.withFix.hasError('required')">
              {{ 'policy.toolBar.ID_VAL_ERR' | translate }}
            </mat-error>
            <mat-error
              *ngIf="
                form.controls.withFix.hasError('pattern') ||
                form.controls.withFix.hasError('max')
              ">
              {{ 'admissionControl.msg.NOT_NUMBER_ERR' | translate }}
            </mat-error>
          </mat-form-field>
          <label for="withFix" class="ml-2">{{ 'cveProfile.DAYS' | translate }}</label>
        </ng-container>
        <ng-container *ngSwitchCase="View.WITHOUT_FIX" class="d-flex flex-row">
          <label for="withoutFix" class="mr-2">{{ 'cveProfile.REPORTED_WITHIN' | translate }}</label>
          <mat-form-field appearance="standard" style="width: 40px;">
            <input
              formControlName="withoutFix"
              id="withoutFix"
              matInput
              (keydown)="onDaysInput($event)"
              (paste)="onDaysInput($event)"
              [attr.maxlength]="5" />
            <mat-error *ngIf="form.controls.withoutFix.hasError('required')">
              {{ 'policy.toolBar.ID_VAL_ERR' | translate }}
            </mat-error>
            <mat-error
              *ngIf="
                form.controls.withoutFix.hasError('pattern') ||
                form.controls.withoutFix.hasError('max')
              ">
              {{ 'admissionControl.msg.NOT_NUMBER_ERR' | translate }}
            </mat-error>
          </mat-form-field>
          <label for="withFix" class="ml-2">{{ 'cveProfile.DAYS' | translate }} ({{ 'cveProfile.WITH_FIX' | translate }})</label>
        </ng-container>
      </div>
    </ng-container>
  </section>
  <section class="row mx-0 align-items-center">
    <mat-form-field appearance="standard" class="col-12">
      <mat-label>{{ 'cveProfile.gridHeader.COMMENT' | translate }}</mat-label>
      <input
        formControlName="comment"
        matInput
        placeholder="Comment..."
        [attr.maxlength]="'general.FILTER_MAX_LEN' | translate" />
    </mat-form-field>
    <div class="col-12 d-flex flex-row align-items-center">
      <div class="mr-4">
        <span class="d-block font-weight-bold">{{
          'cveProfile.gridHeader.IMAGES' | translate
        }}</span>
        <span class="d-block">{{
          'group.editGroup.CONDITION_HINT' | translate
        }}</span>
      </div>
      <label class="sr-only" for="imagesInput">Images</label>
      <mat-form-field appearance="standard" style="width: 60%">
        <mat-chip-list #imageChipList formControlName="images" id="imagesInput">
          <mat-chip
            (removed)="removeImage(image)"
            *ngFor="let image of form.controls.images.value">
            {{ image }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
          <input
            (matChipInputTokenEnd)="addImage($event)"
            [matChipInputAddOnBlur]="addOnBlur"
            [matChipInputFor]="imageChipList"
            [placeholder]="'cveProfile.IMAGES_PLACEHOLDER' | translate"
            [attr.maxlength]="'general.FILTER_MAX_LEN' | translate"
            matInput />
        </mat-chip-list>
        <mat-hint>{{'cveProfile.hint.IMAGE' | translate}}</mat-hint>
      </mat-form-field>
    </div>
    <div class="col-12 d-flex flex-row align-items-center">
      <div class="mr-4">
        <span class="d-block font-weight-bold">{{
          'cveProfile.gridHeader.DOMAINS' | translate
        }}</span>
        <span class="d-block">{{
          'group.editGroup.CONDITION_HINT' | translate
        }}</span>
      </div>
      <mat-form-field appearance="standard" style="width: 60%">
        <mat-chip-list #namespaceChipList aria-label="Namespace selection">
          <mat-chip
            (removed)="removeNamespace(domainChip)"
            *ngFor="let domainChip of domainChips">
            {{ domainChip }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
          <input
            #namespaceInput
            (matChipInputTokenEnd)="addNamespace($event)"
            [matChipInputAddOnBlur]="addOnBlur"
            [formControl]="namespaceCtrl"
            [matAutocomplete]="auto"
            [matChipInputFor]="namespaceChipList"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            [attr.maxlength]="'general.FILTER_MAX_LEN' | translate"
            [placeholder]="'ldap.ADD_DOMAIN' | translate" />
        </mat-chip-list>
        <mat-autocomplete
          #auto="matAutocomplete"
          (optionActivated)="optionActivated($event)"
          (optionSelected)="selected($event)">
          <mat-option
            *ngFor="let domain of filteredDomains | async"
            [value]="domain">
            {{ domain }}
          </mat-option>
        </mat-autocomplete>
        <mat-hint>{{'cveProfile.hint.NAMESPACE' | translate}}</mat-hint>
      </mat-form-field>
    </div>
  </section>
</form>
<div class="d-inline-flex flex-row float-right">
  <button
    type="button"
    (click)="onNoClick()"
    class="mr-2"
    color="warn"
    mat-button>
    {{ 'cveProfile.CANCEL' | translate }}
  </button>
  <button
    type="submit"
    (click)="confirm()"
    [disabled]="!form.valid"
    color="primary"
    mat-raised-button>
    {{
      edit ? ('cveProfile.UPDATE' | translate) : ('cveProfile.ADD' | translate)
    }}
  </button>
</div>
